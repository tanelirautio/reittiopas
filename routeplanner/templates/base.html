<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{ title }}</title>
	<link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
		rel="stylesheet">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/select-css.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/table.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/attention.css') }}">
	<script type="text/javascript" src="{{ url_for('static', filename='js/attention.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='js/check_form.js') }}"></script>
</head>

<body>
	<div class="container">
		<header class="hero">
			<h1 class="hero-title">REITTIOPAS</h1>
		</header>
		<button class="info-toggle" type="button" id="info-toggle">Näytä ohje</button>
		<div class="info-panel is-collapsed" hidden aria-hidden="true">
			<h2>Mikä tämä on?</h2>
			<p>
				Tämä on pieni reittiopas-koodaushaasteprojekti (2020).
				Valitse lähtöpysäkki ja päätepysäkki - sovellus hakee lyhimmän kelvollisen reitin
				kuvitteellisessa bussiverkossa.
			</p>
			<ul>
				<li>Valitse lähtö ja määränpää</li>
				<li>Paina "Hae"</li>
				<li>Katso reitti ja mahdolliset vaihdot taulukosta</li>
			</ul>
			<p class="muted">
				Data on JSON-muodossa (pysäkit, tiet, linjastot).
			</p>
		</div>

		<!--
		<div class="map-panel">
			<h2>Verkkokartta</h2>

			<div class="map-wrapper">
				<img class="network-map" src="{{ url_for('static', filename='images/network.svg') }}"
					alt="Bus network map" />
			</div>

			<p class="muted">
				Kartta on generoitu automaattisesti reittidatasta.
			</p>
		</div>
		-->

		<form method="post" name="route_form" autocomplete="off" onsubmit="return required()" action="/"
			enctype="application/x-www-form-urlencoded">
			<div class="controls card">
				<div class="row">
					<div class="column">
						<label class="field-label" for="origin">Lähtöpysäkki</label>
						<select class="select-css" name="origin" id="origin">
						</select>
					</div>
					<div class="column">
						<label class="field-label" for="destination">Päätepysäkki</label>
						<select class="select-css" name="destination" id="destination">
						</select>
				</div>
				<div class="column column--action">
					<label class="field-label" aria-hidden="true">&nbsp;</label>
					<input id="submit" type="submit" value="Hae">
				</div>
			</div>
			</div>
		</form>
	</div>

	{% block results %}
	{% endblock %}

	<script>
		var stops = {{ stops|tojson }};
		var selected_origin = "{{selected_origin}}";
		var selected_destination = "{{selected_destination}}";
		var infoToggle = document.getElementById("info-toggle");
		var infoPanel = document.querySelector(".info-panel");
		if (infoToggle && infoPanel) {
			infoToggle.addEventListener("click", function () {
				var isHidden = infoPanel.hasAttribute("hidden");
				if (isHidden) {
					infoPanel.removeAttribute("hidden");
					infoPanel.removeAttribute("aria-hidden");
					infoPanel.classList.remove("is-collapsed");
					infoToggle.textContent = "Piilota ohje";
				} else {
					infoPanel.setAttribute("hidden", "");
					infoPanel.setAttribute("aria-hidden", "true");
					infoPanel.classList.add("is-collapsed");
					infoToggle.textContent = "Näytä ohje";
				}
			});
		}

		var originSelect = document.getElementById("origin");
		var el = document.createElement("option");
		el.textContent = "Lähtöpysäkki";
		el.value = "Lähtöpysäkki";
		if (selected_origin == "") {
			el.selected = true;
		}
		originSelect.appendChild(el);
		for (var i = 0; i < stops.length; i++) {
			var stop = stops[i];
			var el = document.createElement("option");
			el.textContent = stop;
			el.value = stop;
			if (stop == selected_origin) {
				el.selected = true;
			}
			originSelect.appendChild(el);
		}

		var destinationSelect = document.getElementById("destination");
		var el = document.createElement("option");
		el.textContent = "Päätepysäkki";
		el.value = "Päätepysäkki";
		if (selected_destination == "") {
			el.selected = true;
		}
		destinationSelect.appendChild(el);
		for (var i = 0; i < stops.length; i++) {
			var stop = stops[i];
			var el = document.createElement("option");
			el.textContent = stop;
			el.value = stop;
			if (stop == selected_destination) {
				el.selected = true;
			}
			destinationSelect.appendChild(el);
		}

	</script>

</body>
